简化一下P04的笔记

# 构建去中心化的货币系统

我们假设央行要发行数字货币，很直观的是参考现金的发行形式，现金的特征是：

1. 防伪标记： 难以伪造，不可篡改
2. 唯一性：无法复制，



防伪标记通过公私钥体系就能很好解决。

唯一性很重要，因为代码本身是文件可以无限复制，不能保证唯一性就会导致双花攻击，即一个货币被消费多次，


保持货币的唯一性，中心化货币系统的解决方案是中心化记账法，维护货币与持有者的关系，但这种方案的缺点是每一次交易都需要央行系统确认。


去中心化货币系统的解决方案是区块链技术：

```plain
               ┌───────────┐    ┌──────────────┐     ┌─────────────┐              
               │           │    │              │     │             │              
 ┌─────────────┼────┐     ┌┼────▼──────┐     ┌─┼─────▼──────┐    ┌─┼────────────┐ 
 │ create coin │    │     │A┌──►B(5)   │     │ B┌───►C(2)   │    │ C────►E(7)   │ 
 │             ▼    │     │ │          │     │  │           │    │ │            │ 
 │       ─────►A(10)│◄────┤ │          │◄────┤  │           │◄───┤ │            │ 
 │                  │     │ └──►C(5)   │     │  └───►D(3)   │    │ │            │ 
 │                  │     │ signed by A│     │  signed by B │    │ │signed by C │ 
 └──────────────────┘     └─────▲──────┘     └──────────────┘    └─┼────────────┘ 
                                │                                  │              
                                │                                  │              
                                └──────────────────────────────────┘              
                                                                                            
                                                                                  
```

比特币的每个交易都包含了输入、输出和「签名」。

1. 输入部分：
    1. 币的来源：它能够追踪币的来源来确认交易的起源，防止同一个货币被多次消费。
    2. 转账方的公钥哈希：能够与币的来源的区块的输出部分的 收款人的公钥哈希交叉验证，确保公钥没有伪造；
2. 输出部分包含了 收款人的公钥哈希；
3. 签名：转账方用私钥对交易的签名，与转账方的公钥哈希进行交叉验证。



比特币的系统中，因为可能存在恶意的节点，所以需要确认哪个节点有将交易写入区块的权利，比特币利用了基于计算力投票而非账户数目的投票来防止女巫攻击。


基于计算力投票（也被称为工作量证明）其实就是暴力破解一个系统预先设定的随机数，最先破解的节点拥有写入区块的权利（记账权）并获取BTC奖励，同时为了防止硬分叉攻击，规定被接受的区块一定在**最长合法链**上，非最长合法链上的区块会被丢弃掉。


```plain
                                                  ┌───────┐◄──┬───────┐ 
                                              ┌───┤       │   │       │ 
 ┌──────┐◄──┬──────┐ ◄───┬──────┐◄───┬──────┐ │   └───────┘   └───────┘ 
 │C->A  │   │      │ ◄┐  │ A->B │    │      │◄┘                         
 └──────┘   └──────┘  │  └──────┘    └──────┘◄┐   ┌───────┐             
                      │                       └───┼       │             
                      │                           └───────┘             
                      └──┬──────┐                 orphan block          
                         │A->A' │                                       
                         └──────┘                                       
```
