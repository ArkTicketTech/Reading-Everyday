继续复习ddia。

# chap5
复制策略：
1. 全同步复制：安全，写的性能差
2. 全异步复制：写的性能高，但容易丢数据
3. 半同步复制：折中


节点宕机了，
1. 如果是slave，通过日志可以追赶恢复
2. 如果是master，会进行故障切换

复制延迟可能带来的问题：
1. 读写延迟
2. 时光倒流：确保用户始终从某一个读库读取
3. 因果关系混乱：确认任何因果相关的写入写入相同的分区。


复制的三种主要方法：单主复制、多主复制、无主复制。


无主复制因为没有领导者，写入节点和读取节点的个数由法定人数算法决定；
如果明确知道写入的顺序，就用最后写入胜利；
但如果不知道就说明是并发场景，为了解决并发的写冲突问题，
1. 写入之前要读取；
2. 读取的值如果有新数据，那就进行合并再写入

合并有特定数据结构比如CRDT来合并并发冲突。

# chap6 

分区：逻辑上在一张表的数据，物理分布在多个节点。

分区策略：
1. 随机分配
2. 基于hash key的范围分区：范围查询开销大
3. 直接基于key的范围分区：某些key有热点问题

二级索引分区：
1. 本地索引：分区独立维护二级索引，实现简单应用广泛，但读取需要合并结果
2. 全局索引：单个节点维护全局索引，读取快，但对写操作不友好。


分区再平衡：节点变化，数据需要转移。
