# Learning OpenTelemetry Setting Up and Operating a Modern Observability System pp. 31-40

#### Observability Context

在 OpenTelemetry 中有三种基本的上下文类型：时间、属性和上下文对象本身。

时间似乎是对事件进行排序的一种非常合乎逻辑的方式，但在考虑分布式系统中的遥测时，它却是极其不可靠的。时钟可能会由于多种因素而漂移并变得不准确，包括线程的暂停执行、资源耗尽、设备的睡眠/唤醒行为或网络连接的丢失。即使在单个 JavaScript 进程中，系统时钟在一个小时内也可能会丢失高达约100毫秒的精度。这就是为什么特定上下文（例如跟踪中的调用关系或共享属性）如此有用的众多原因之一。

#### The Context Layer

上下文是遥测系统的重要组成部分。从高层次上讲，将上下文定义为“一个传播机制，它在 API 边界和逻辑上相关的执行单元之间携带执行范围内的值。”（执行单元是线程、协程或语言中的其他顺序代码执行结构。）换句话说，上下文跨越鸿沟传递信息：在同一台计算机上通过管道在两个服务之间传递，通过远程过程调用在不同服务器之间传递，或在单个进程中的不同线程之间传递。

上下文层的目标是为现有的上下文管理器（例如 Golang 的 context.Context、Java 的 ThreadLocals 或 Python 的上下文管理器）或其他合适的载体提供一个干净的接口。重要的是，必须使用上下文，并且它包含一个或多个传播器。

传播器是将值从一个进程发送到下一个进程的实际方式。当一个请求开始时，OpenTelemetry 会根据注册的传播器为该请求创建一个唯一标识符。然后可以将此标识符添加到上下文中，序列化并发送到下一个服务，后者会反序列化它并将其添加到本地上下文中。

语义约定过程的目标是创建一套标准化和具有代表性的元数据集，这些元数据不仅可以准确建模和描述分布式系统中支持给定事务的底层资源，还可以描述实际事务本身。（如果说跟踪、指标和日志是描述系统如何运行的动词，那么语义约定就提供了描述系统正在做什么的名词。）

#### Attributes and Resources

OpenTelemetry 发出的每一条遥测数据都有属性。在其他监控系统中，这些被称为字段或标签。这些属性是一种元数据，用来告诉你一条遥测数据代表什么。简单来说，属性是描述一条遥测数据的有趣或有用维度的键值对。如果想了解系统中发生了什么，属性就是你希望进行过滤或分组的内容。

在 OpenTelemetry 中，默认情况下，任何单条遥测数据最多可以有128个唯一属性；这些值的长度没有限制。

OpenTelemetry 还定义了一种特殊类型的属性，称为资源。属性和资源之间的区别很简单：属性可以在不同请求之间变化，而资源在整个进程的生命周期内保持不变。例如，服务器的主机名将是一个资源属性，而客户 ID 则不是。
