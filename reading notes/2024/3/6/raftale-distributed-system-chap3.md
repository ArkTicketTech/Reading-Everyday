## CAP定理

CAP定理指出，在一个异步网络环境，对于一个分布式读写存储系统来说，只能满足以下三项中的两项，不可能满足全部三项。

1. 一致性（Consistency）：客户端访问所有节点，返回的都是同一份最新的数据（线性一致性）；
2. 可用性（Availability）：每次请求都能获取非错误的响应，但不保证获取的数据是最新数据；
3. 分区容错性（Partition Tolerance）：节点之间由于网络分区而导致消息丢失的情况下，系统仍能正常运行。

可以用反证法证明CAP定理，如果有分区容错但又要保持可用，必然会损失一致性。

CAP的意义在于，系统设计必须要有取舍。通常有两类：

1. CP：一致性和分区容错性
2. AP：可用性和分区容错性

在满足分区容错性的条件下，只能选择保证一致性或者可用性。

但CAP如今颇受争议，Eric Brewer在2012的一篇文章中指出，三选二的说法是错误的，因为网络分区是一种故障类型，不管如何都会发生。网络正常的时候，系统可以提供一致性（线性一致性）和整体可用性。发生网络故障时，你必须在线性一致性和整体可用性之间做出选择。

因此，CAP 更好的表述成：在分区时要么选择一致，要么选择可用。一个更可靠的网络需要减少这个选择，但是在某些时候选择是不可避免的。

CAP 定理的正式定义仅限于很狭隘的范围，它只考虑了一个一致性模型（即线性一致性）和一种故障（网络分区 ，或活跃但彼此断开的节点）。它没有讨论任何关于网络延迟，死亡节点或其他权衡的事。
