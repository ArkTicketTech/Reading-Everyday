主要讨论数据库集群的问题

# 分区

分区带来了扩展性。

分区是将一个数据集拆分为多个较小的数据集。

数据分区后，我们就可以向系统中增加更多节点来增加系统可以存储和处理的数据规模。

分区增加了数据的可管理性、可用性和可扩展性。



分区分为垂直分区和水平分区。

分布式系统中，水平分区也称为分片（Shard）。

## 水平分区算法

1. 范围分区
    1. 优点：实现简单；支持范围查询；
    2. 缺点：无法直接使用分区以外的其他字段查询；范围查询过大时性能差；数据分布不均匀时容易造成热点数据；

1. 哈希分区
    1. 优点：分布均匀
    2. 缺点：不支持范围查询；扩容和缩容需要重新移动数据；

1. 一致性哈希
    1. 优点：扩缩容时不会导致映射失效；
    2. 缺点：实现复杂

分区后的不足是join查询低效。分布式事务复杂。

# 复制

分区提高了可扩展性和性能，而复制则提高了可用性。

复制是将同一份数据冗余存储在多个节点上，节点间通过网络来同步数据，使之保持一致。一个存储了复制数据的节点称为副本，复制和分区可以一起使用。

复制的好处：

1. 增强数据的可用性和安全性
2. 减少往返时间：部署在离用户近的地理区域
3. 增加吞吐量：副本提供访问功能

## 单主复制

主节点只有一个，其余的都是副本，主节点能进行读写，副本只能进行读操作。

同步方式：

1. 同步复制
2. 异步复制
3. 半同步复制

单主复制的主要优点是：

1. 简单易懂，易于实现
2. 尽在主节点执行写操作，避免数据冲突
3. 对于大量读请求工作负载的系统，单主复制可以通过多个从节点来提升性能。



缺点：

1. 大量写请求的系统很难扩展
2. 主节点宕机后，从节点提升为主节点有局限
    1. 手动切换需要停机时间
    2. 自动切换容易产生脑裂问题

目前的PostgreSQL和MySQL都支持单主复制。
