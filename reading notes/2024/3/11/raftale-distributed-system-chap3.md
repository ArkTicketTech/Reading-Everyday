## 顺序一致性

顺序一致性同样允许对并发操作进行重新排列，但它不要求在全局时钟下不同客户端的先后顺序固定。

与线性一致性的主要区别在于没有全局时间的限制。

与线性一致性一样，现代CPU在默认情况下也不保证顺序一致性，因为顺序一致性严格限制了程序的执行顺序。现代编译器和CPU通常会优化指令的执行顺序，来提升程序性能。

## 因果一致性

因果一致性比顺序一致性更弱，它要求，必须以相同的顺序看到因果关系的操作，而没有因果关系的并发操作可以被不同的进程以不同的顺序观察到。

最典型的因果关系就是 必须先有发帖才能有该帖子的评论。

## 最终一致性

最终一致性是个比较笼统的说法，它主要是系统最终能达到一个稳定的状态就行。

例子：分布式存储系统Dynamo

## 以客户端为中心的一致性模型

前面讨论的四种一致性都是以数据为中心的一致性模型。

还有一种以客户端为中心的一致性模型，这类一致性模型从客户端的角度来观察分布式系统，

以数据为中心的一致性模型常常考虑多个客户端时的系统状态，而以客户端为中心的一致性模型聚焦于单个客户端观察到的系统状态。

1. 单调读：如果客户端读到关键字x的值为v，那么该客户端对于x的任何后续的读操作必须返回v或者比v更新的值，即保证客户端不会读到旧的值。
   a. DDIA第五章中有讲到，单调读是为了在多个副本下防止「时光倒流」，实现单调读的一种方式是确保每个用户总是从一个副本进行读取。
2. 单调写：同一个客户端的写操作在所有副本上都以相同的顺序执行，即保证客户端的写操作是串性的。例如，客户端先执行写操作x=0，再执行写操作x=1，如果另一个客户端不停地读x的值，那么会先读到x的值先为0再为1，不会先读到1再读到0。
   a. 没明白是什么场景
3. 读已之写（Read My Write）：单个客户端当写操作完成后，在同一副本或者其他副本上的读操作必须能够读到写入的值。
   a. DDIA第五章中有讲到
4. PRAM一致性（Pipelined RAM）：它是由单调读、单调写、读已之写组成的。





# 隔离级别

隔离级别定义了并发系统中事务的结果何时、以何种方式对其他事务可见。

隔离级别这块内容看DDIA第七章事务比较清晰。



# 本章小结

> Jepsen是一款用于系统测试的开源软件库，可用于评估分布式系统的正确性，对系统进行一致性验证。


设计一个分布式存储系统非常困难：

1. 当单机数据量太大，需要在多台服务器上进行分区；
2. 由于有多台服务器，故障就可能越多，就需要能够容错；
3. 为了提高容错，需要复制副本。
4. 副本下的数据会有延迟，甚至不一致
5. 为了提高一致性，有共识算法和各种优化，但这样又降低了性能。

没有完美的系统，最关键的是如何进行取舍。
