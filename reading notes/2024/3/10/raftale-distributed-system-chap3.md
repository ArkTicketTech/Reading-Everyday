# 一致性模型
数据库ACID中的一致性是指的一种约束，这种约束或来自于数据库的完整性约束，或是用户对业务场景的定义约束。
这里讲的一致性模型是指，在并发编程中，系统和开发者之间的一种约定，如果开发者遵循某种某些规则，那么开发者执行读写操作的结果是可预测的。
一致性模型本质上定义了写操作的顺序和可见性，即并发写操作执行的顺序是怎样的，写操作的结果何时能被别的进程看见。

CAP定理中的一致性是指线性一致性，常见的一致性模型有很多，比较有名的是Jepsen对一致性模型的分类。
按照可用性分类：
1. 不可用：CP类系统，网络分区时，为了保证数据一致性和正确性，系统会不可用。
   a. 线性一致性
   b. 顺序一致性
2. 基本可用：可以容忍一部分节点发生故障，还未出现故障的节点仍然可用，但前提是客户端不能将请求发送到不可用的副本节点上。
   a. 因果一致性
   b. PRAM一致性
   c. 读你所写
3. 高可用：即使网络分区，在没有发生故障的节点上，仍然保证可以用
   a. 读后写
   b. 单调读
   c. 单调写
   下面这张图展示了各种一致性模型之间的包含关系和强弱关系。

## 线性一致性
线性一致性（Linearizability）是最强的一致性模型，也被称为原子一致性、强一致性、立即一致性等。
线性一致性实际上是一个并发编程领域的概念，不止用于分布式系统。
1. 非严格定义：分布式系统的操作看起来都是原子的，整个分布式系统看起来好像只有一个节点。
   a. 原子和一个节点都意味着没有并发问题，说明系统是可预测的。
   b. 单机上为了提供一致性，硬件、操作系统、编程语言会提供一些同步原语和原子变量。
2. 严格定义：给定一个执行历史，执行历史会根据并发操作可以扩展为多个顺序历史，只要从中找到一个合法的顺序历史，那么该执行历史就是线性一致性的。
   a. 两个约束条件
   ⅰ. 顺序记录中的任何一次读必须读到最近一次写入的数据
   ⅱ. 顺序记录要跟全局时钟下的顺序一致
    1. 这意味着我们要知道操作之间的先后关系


## 实现线性一致性
单机上实际上就是多线程编程保证线程安全；
分布式系统上就是使用共识算法来实现，但并不是实现了共识算法就等于实现了线性一致性。
后续将共识算法再讲解。

## 线性一致性的代价
代价高昂，并发编程中的同步原语和原子变量会增加系统开销。
分布式系统中线性一致性最困难的是需要一个全局时钟。
