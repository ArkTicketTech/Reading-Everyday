副本的作用：
1. 冗余
2. 提高伸缩性
3. 异地

基于领导者的副本机制：

好处：
1. 读已之写
2. 实现单调读

复制机制：

副本如果在replica.lag.time.max.ms时间内没有请求最新数据，就会被认为不是同步副本（ISR：In-Sync Replicas），
在没有开启Unclean Leader Election时（不建议开启），只有同步副本能参与选举。


kafka的请求是怎么被处理的？

Reactor模式。
1. Acceptor线程：采用轮询的方式将入站请求公平地发到所有网络线程中
2. 网络线程池：num.network.threads，默认为3，每台broker启动时会创建3个网络线程，网络线程池接收到请求后，并不是自己处理具体任务，而是将请求放入到一个共享队列中；待任务处理完后，网络线程池还会负责将response返回给客户端。
3. IO线程池；num.io.threads，默认为8。负责从该队列中取出请求，执行真正的处理。

Purgatory炼狱组件：用来缓存延迟请求。
比如acks=all时，那么就必须等待ISR中所有副本都接受完消息才返回，此时处理该请求的IO线程就必须等待其他Broker的写入结果，当请求不能立刻处理时，它就会暂存在Purgatory中。
